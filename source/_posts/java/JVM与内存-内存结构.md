---
title: (JVM)JVM与内存（二）：垃圾回收器与堆内存
date: 2021-06-29 11:53:09
categories: Java
tags: 
  - JVM
  - 内存
---

## 概述

本文以Java1.8为准，概述JVM内存结构。

<!-- more -->

JVM管理的内存主要分为三个部分：堆内存、元数据区、栈内存、程序计数器和直接内存。

首先看一张图，说明JVM内存结构总览：

![](jvmmemstruct.png)

## 堆内存 （线程共享）

堆内存是在JVM中占用空间最大的一部分内存。Java运行时的对象都分配在堆内存上。其中分为以下几个部分：

- 年轻代，年轻代又分为Eden区和 From/To Survivor 三个部分。默认按照8:1:1来分配年轻代内存。

- 老年代，对象进入老年代有以下几种方式：

1、存活对象达到年龄阈值，默认是15。（存储在对象的Header部分，可通过-XX:MaxTenuringThreshold配置阈值）

2、大对象直接分配在老年代。（可以通过-XX:PretenureSizeThreshold=3m配置大对象阈值）

3、动态年龄判断，当 Survivor 空间中相同年龄所有对象的大小总和大于 Survivor 空间的一半，年龄大于或等于该年龄的对象就可以直接进入老年代，而不需要达到默认的分代年龄。

## 元数据（线程共享）

在1.8之前，元数据区又被称为方法区，并和堆内存的老年代共同管理。在1.8之后独立出元数据区。

默认元数据区没有大小限制，可以通过参数 –XX:MetaspaceSize 配置，默认是21m。

它用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。

## 程序计数器 （线程独占）

可以看作是当前字节码执行行号的标记。每个线程都有一个独立的程序计数器，通过修改计数器来实现代码的逻辑控制。

## 栈内存（线程独占）

由多个栈帧组成，其中保存有局部变量、操作数栈、动态链接和方法返回地址等信息。

## 直接内存